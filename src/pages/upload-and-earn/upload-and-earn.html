<!--
  Generated template for the UploadAndEarnPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar color="clickinn">
    <ion-title>Upload</ion-title>
  </ion-navbar>
</ion-header>
<ion-content>
  <div *ngIf="loading" class="centered_on_screen" style="background: rgba(0, 0, 0, 0.8); color: white; font-size: 35; 
    border-radius: 10px;padding: 20px; text-align: center; z-index: 1">
    <ion-spinner name="ios"></ion-spinner>
    <h3 text-center>Saving progress...</h3>
  </div>
  <!-- <div *ngIf="uploading" class="centered_on_screen" style="background: rgba(0, 0, 0, 0.8); color: white; font-size: 35; 
    border-radius: 10px;padding: 20px; text-align: center; z-index: 1">
    <ion-spinner name="ios"></ion-spinner>
    <h3 text-center>Uploading apartment advert...</h3>
  </div> -->
  <ion-grid no-padding>
    <ion-row>
      <ion-col col-0 col-sm-0 col-md-0 col-lg-3>
      </ion-col>
      <ion-col col-12 col-sm-12 col-md-12 col-lg-6>
        <ion-stepper #stepper mode="horizontal" (selectIndexChange)="selectChange($event)">
    <ion-step>
      <h1 text-center>Apartment Details</h1>
      <ion-item no-lines margin-vertical text-wrap style="letter-spacing: 2px;border-radius: 7px; background: #f4f4f4;">
        <p text-center>
          <strong>Please fill out the details of the apartment in full</strong> 
        </p>
        <ion-buttons end>
          <button ion-button small clear>
            <div style="color: #32db64">
              <!-- personnel ~ {{channel?.creator?.firstname}} {{channel?.creator?.lastname}} -->
            </div>
          </button>
        </ion-buttons>
      </ion-item>
      <ion-item text-wrap>
        <ion-label>Your role</ion-label>
        <ion-select [(ngModel)]="apartment.by" required>
          <ion-option value="Owner">Owner</ion-option>
          <ion-option value="Agent">Agent</ion-option>
        </ion-select>
      </ion-item>
      <ion-item text-wrap>
        <ion-label>Apartment Type</ion-label>
        <ion-select [(ngModel)]="apartment.room_type" required>
          <ion-option value="Back room">Back room</ion-option>
          <ion-option value="2 Bedroom flat">2 Bedroom flat</ion-option>
          <ion-option value="1 Bedroom flat">1 Bedroom flat</ion-option>
          <ion-option value="Bachelor flat">Bachelor/Studio flat</ion-option>
          <ion-option value="Cottage">Cottage</ion-option>
          <ion-option value="Single Room">Single room</ion-option>
          <ion-option value="2 Sharing Room">2 Sharing room</ion-option>
          <ion-option value="3 Sharing Room">3 Sharing room</ion-option>
          <ion-option value="Any">Any</ion-option>
        </ion-select>
      </ion-item>
      <ion-item text-wrap>
        <ion-label floating style="letter-spacing: 2px; font-weight: 5px; font-stretch: 10px"><strong>Quantity of same apartments available</strong></ion-label>
        <ion-input type="number" [(ngModel)]="apartment.quantity_available" required></ion-input>
      </ion-item>
      <ion-item text-wrap>
        <ion-label floating style="letter-spacing: 2px; font-weight: 5px; font-stretch: 10px"><strong>Monthly Rent (Rands)</strong></ion-label>
        <ion-input type="number" [(ngModel)]="apartment.price" required></ion-input>
      </ion-item>
      <ion-item text-wrap >
        <ion-label floating style="letter-spacing: 2px; font-weight: 5px; font-stretch: 10px"><strong>Deposit/Securing fee ( including 1st month rent ) (Rands)</strong></ion-label>
        <ion-input type="number" [(ngModel)]="apartment.deposit" required></ion-input>
      </ion-item>
      <ion-item  margin-vertical no-lines>
        <ion-textarea text-center rows="5"
            placeholder="Descibe the apartment e.g. 'Spacious single room, fully furnished  with private bathroom etc..." 
            [(ngModel)]="apartment.description">
         </ion-textarea>
      </ion-item>
      <ion-buttons end>
        <button ion-button color="clickinn" round outline ionicStepperNext (click)="apartmentUpdateOrInit(); scrollToTop()">
          <strong>Next</strong>&nbsp;&nbsp;
          <ion-icon name="arrow-round-forward"></ion-icon>
        </button>
      </ion-buttons>
      </ion-step>
      <ion-step>
        <h1 text-center>Apartment Pictures</h1>
        <ion-item no-lines text-wrap style="border-radius: 7px; background: #f4f4f4; letter-spacing: 2px">
        <p text-center>
          Select pictures of only the interior of the apartment (Select the images one by one and crop to prescribed size)  
        </p>
        <ion-buttons end>
          <button ion-button small clear>
            <div style="color: #32db64">
              <!-- personnel ~ {{channel?.creator?.firstname}} {{channel?.creator?.lastname}} -->
            </div>
          </button>
        </ion-buttons>
      </ion-item>
        <ion-grid>
          <ion-row>
            <ion-col col-md-6 col-sm-6 *ngFor="let image of apartmentImages">
              <img *ngIf="onMobile" src="{{image?.file}}"/>
            </ion-col>
          </ion-row>
        </ion-grid>
          <!-- <input type="file" accept="image/*"  (change)="updateApartmentPics($event)"> -->
          <ion-row>
            <ion-col col-6 *ngIf="!apartmentImagesAdded">
              <button ion-button color="clickinn" padding outline margin-vertical (click)="addPictures(1, 1)" >
                <strong>CAMERA</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-camera-outline"></ion-icon> 
              </button>
            </ion-col>
            <ion-col col-6 *ngIf="!apartmentImagesAdded">
              <button ion-button color="clickinn" padding  outline margin-vertical  (click)="addPictures(2, 1)" >
               <strong>GALLERY</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-images-outline"></ion-icon>  
              </button>
            </ion-col>
            <ion-col col-6 *ngIf="apartmentImagesAdded">
                <button ion-button color="clickinn" padding  outline margin-vertical (click)="addPictures(1, 1)">
                  <strong>MORE</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-camera-outline"></ion-icon>   
                </button>
            </ion-col>
            <ion-col col-6 *ngIf="apartmentImagesAdded">
              <button ion-button color="clickinn" padding  outline margin-vertical (click)="addPictures(2, 1)" >
                <strong>MORE</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-images-outline"></ion-icon>  
              </button>
            </ion-col>
          </ion-row>
          
        <ion-buttons text-center>
          <button ion-button round color="clickinn" padding outline small ionicStepperPrevious (click)="scrollToTop()" >
            <ion-icon name="arrow-round-back"></ion-icon> &nbsp;&nbsp;Back
          </button>
          <button ion-button small padding color="clickinn" round outline ionicStepperNext (click)="uploadApartPics(); scrollToTop()">Next&nbsp;&nbsp;
          <ion-icon name="arrow-round-forward"></ion-icon>
          </button>
        </ion-buttons>
      </ion-step>
      <ion-step>
        <h1 text-center>Building Details</h1>
        <ion-item no-lines text-wrap style="border-radius: 7px; background: #f4f4f4; letter-spacing: 2px">
        <p text-center>
          Select building from the list of building profile you have already created or fill details of the new building which the apartment belongs to  
        </p>
        <ion-buttons end>
          <button ion-button small clear>
            <div style="color: #32db64">
              <!-- personnel ~ {{channel?.creator?.firstname}} {{channel?.creator?.lastname}} -->
            </div>
          </button>
        </ion-buttons>
      </ion-item>
        <ion-buttons margin-vertical>
          <button ion-button clear color="clickinn" icon-right *ngIf="openList" (click)="closeList()" >
            Close list &nbsp;&nbsp;&nbsp;<ion-icon name="arrow-dropup" end></ion-icon>
          </button>
          <button ion-button clear color="clickinn" icon-right *ngIf="!openList" (click)="showList()">
            Select building from list &nbsp;&nbsp;&nbsp;<ion-icon name="arrow-dropdown" end></ion-icon>
          </button>
        </ion-buttons>
        <ion-grid *ngIf="openList">
          <ion-row>
            <ion-col col-12 col-md-6 col-sm-6 *ngFor="let building of buildings; let i = index" 
               (click)="selectEBuilding(building)" ionicStepperNext>
            <ion-item text-wrap>
              <ion-avatar item-start>
                <img src="{{building?.dP?.url}}" (load)="imagesLoaded[i] = true" [hidden]="!imagesLoaded[i]" />
                <img src="assets/imgs/placeholder.jpg" [hidden]="imagesLoaded[i]" />
              </ion-avatar>
              <p>{{building?.address?.description}}</p>
            </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
        <ion-item>
          <ion-label stacked style="letter-spacing: 2px">Building Address</ion-label>
          <ion-input type="search" [(ngModel)]="address" placeholder="eg 79 Caroline Street..." (keyup)="getPredictionsAdd($event)">
          </ion-input>
        </ion-item>
        <ion-list *ngIf="predictionsAdd">
          <button ion-item *ngFor="let pred of predictionsAdd" (click)="selectPlace(pred)">{{pred?.description}}</button>
        </ion-list>
        <ion-item>
          <ion-label stacked style="letter-spacing: 2px">Places of interest within 10 min walk</ion-label>
          <ion-input type="search" [(ngModel)]="nearby" placeholder="eg Campus Square Mall" (keyup)="getPredictionsNby($event)">
          </ion-input>
        </ion-item>
        <ion-list *ngIf="predictionsNby">
          <button ion-item *ngFor="let pred of predictionsNby" (click)="addNearby(pred?.description)">{{pred?.description}}</button>
        </ion-list>
        <ion-list *ngIf="building.nearbys">
          <ion-item text-wrap *ngFor="let nby of building.nearbys" margin-vertical (click)="deleteNearby(nearby)">
            <ion-icon name="close" start></ion-icon> &nbsp;&nbsp;&nbsp;{{ nby }}
          </ion-item>
        </ion-list>
        <ion-item  padding no-lines>
           <ion-label>NSFAS accredited</ion-label>
           <ion-checkbox [(ngModel)]="building.nsfas"></ion-checkbox>
        </ion-item>
        <ion-item  padding no-lines>
           <ion-label>Has secure parking</ion-label>
           <ion-checkbox [(ngModel)]="building.parking"></ion-checkbox>
        </ion-item>
        <ion-item  padding no-lines>
           <ion-label>Free WiFi</ion-label>
           <ion-checkbox [(ngModel)]="building.wifi"></ion-checkbox>
        </ion-item>
        <ion-item  padding no-lines>
           <ion-label>Has laundry machine/s</ion-label>
           <ion-checkbox [(ngModel)]="building.laundry"></ion-checkbox>
        </ion-item>
        <ion-buttons text-center margin-vertical>
          <button ion-button padding round outline small color="clickinn" ionicStepperPrevious (click)="scrollToTop()" >
            <ion-icon name="arrow-round-back"></ion-icon> &nbsp;&nbsp;Back
          </button>
          <button ion-button padding small round outline ionicStepperNext color="clickinn" (click)="buildingUpdateOrInit(); scrollToTop()">Next&nbsp;&nbsp;
          <ion-icon name="arrow-round-forward"></ion-icon>
          </button>
        </ion-buttons>
      </ion-step>
      <ion-step>
        <h1 text-center *ngIf="!buildingSelected">Building Pictures</h1>
        <h1 text-center *ngIf="buildingSelected">Upload Building</h1>
        <ion-item *ngIf="!buildingSelected" no-lines text-wrap style="border-radius: 7px; background: #f4f4f4; letter-spacing: 2px">
          <p text-center>
            Add pictures of the communal areas of the building, like bathrooms, kitchen, laundry, pool etc
            (Add pictures one at a time and crop to the specified dimensions)  
          </p>
          <ion-buttons end>
            <button ion-button small clear>
              <div style="color: #32db64">
                <!-- personnel ~ {{channel?.creator?.firstname}} {{channel?.creator?.lastname}} -->
              </div>
            </button>
          </ion-buttons>
        </ion-item>
          <ion-item text-wrap no-lines *ngIf="buildingSelected">
            <ion-avatar item-start>
              <img src="{{building?.dP?.url ? building?.dP?.url : 'assets/imgs/placeholder.jpg'}}"/>
            </ion-avatar>
            <p>{{building.address.description}}</p>
          </ion-item>
          <ion-grid>
            <ion-row style="border-bottom: 1px solid lightgray">
              <ion-col col-md-6 *ngFor="let image of propertyImages">
                <img src="{{image?.file ? image?.file : 'assets/imgs/placeholder.jpg'}}"/>
              </ion-col>
            </ion-row>
          </ion-grid>

          <ion-row>
            <ion-col col-6 *ngIf="!propertyImagesAdded && !buildingSelected">
              <button ion-button color="clickinn" padding outline margin-vertical (click)="addPictures(1, 2)" >
                <strong>CAMERA</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-camera-outline"></ion-icon> 
              </button>
            </ion-col>
            <ion-col col-6 *ngIf="!propertyImagesAdded && !buildingSelected">
              <button ion-button color="clickinn" padding  outline margin-vertical  (click)="addPictures(2, 2)" >
               <strong>GALLERY</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-images-outline"></ion-icon>  
              </button>
            </ion-col>
            <ion-col col-6 *ngIf="propertyImagesAdded && !buildingSelected">
                <button ion-button color="clickinn" padding  outline margin-vertical (click)="addPictures(1, 2)">
                  <strong>MORE</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-camera-outline"></ion-icon>   
                </button>
            </ion-col>
            <ion-col col-6 *ngIf="propertyImagesAdded && !buildingSelected">
              <button ion-button color="clickinn" padding  outline margin-vertical (click)="addPictures(2, 2)" >
                <strong>MORE</strong>&nbsp;&nbsp;&nbsp;&nbsp;<ion-icon name="ios-images-outline"></ion-icon>  
              </button>
            </ion-col>
          </ion-row>
          
        <ion-buttons>
          <button ion-button padding color="clickinn" round outline small ionicStepperPrevious (click)="scrollToTop()" >
            <ion-icon name="arrow-round-back"></ion-icon> &nbsp;&nbsp;Back
          </button>
        </ion-buttons>
        <progress-bar *ngIf="uploading" [progress]="progss" [color]="'#488aff'">
        </progress-bar> 
        <ion-buttons padding>
          <button ion-button  padding color="secondary" full padding (click)="uploadApartment()">Upload&nbsp;&nbsp;
          <ion-icon name="ios-cloud-upload-outline"></ion-icon>
          </button>
        </ion-buttons>
      </ion-step>
    </ion-stepper>
      </ion-col>
      <ion-col col-0 col-sm-0 col-md-0 col-lg-3>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
